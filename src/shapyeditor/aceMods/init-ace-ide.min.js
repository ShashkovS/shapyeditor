import"../ace/ace.min.js";import"../ace/ext-language_tools.js";import"../ace/ext-searchbox.js";import DocTooltip from"./doc-tooltip.js";import Completions from"./completions.js";import"./mode-python-with-worker.js";const ace=window.ace;ace.config.set("basePath",new URL("../ace",import.meta.url).pathname);const langTools=ace.require("ace/ext/language_tools"),useragent=ace.require("ace/lib/useragent");function duplicateSmart(e){e.getSelectionRange().isEmpty()?e.execCommand("copylinesdown"):e.execCommand("duplicateSelection")}function bindPyCharmKeymap(e,{onFormat:n}={}){useragent.isMac;const o=[{name:"pycharm-duplicate",bindKey:{win:"Ctrl-D",mac:"Command-D"},exec:duplicateSmart},{name:"pycharm-delete-line",bindKey:{win:"Ctrl-Y",mac:"Command-Backspace"},exec:e=>e.execCommand("removeline")},{name:"pycharm-move-line-up",bindKey:{win:"Alt-Shift-Up",mac:"Alt-Shift-Up"},exec:e=>e.execCommand("movelinesup")},{name:"pycharm-move-line-down",bindKey:{win:"Alt-Shift-Down",mac:"Alt-Shift-Down"},exec:e=>e.execCommand("movelinesdown")},{name:"pycharm-toggle-line-comment",bindKey:{win:"Ctrl-/",mac:"Command-/"},exec:e=>e.execCommand("togglecomment")},{name:"pycharm-toggle-block-comment",bindKey:{win:"Ctrl-Shift-/",mac:"Command-Alt-/"},exec:e=>e.execCommand("toggleBlockComment")},{name:"pycharm-find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:e=>e.execCommand("find")},{name:"pycharm-replace",bindKey:{win:"Ctrl-R",mac:"Command-R"},exec:e=>e.execCommand("replace")},{name:"pycharm-find-next",bindKey:{win:"F3",mac:"F3"},exec:e=>e.execCommand("findnext")},{name:"pycharm-find-prev",bindKey:{win:"Shift-F3",mac:"Shift-F3"},exec:e=>e.execCommand("findprevious")},{name:"pycharm-goto-line",bindKey:{win:"Ctrl-G",mac:"Command-L"},exec:e=>e.execCommand("gotoline")},{name:"pycharm-add-caret-above",bindKey:{win:"Ctrl-Alt-Up",mac:"Option-Command-Up"},exec:e=>e.execCommand("addCursorAbove")},{name:"pycharm-add-caret-below",bindKey:{win:"Ctrl-Alt-Down",mac:"Option-Command-Down"},exec:e=>e.execCommand("addCursorBelow")},{name:"pycharm-select-next-occurrence",bindKey:{win:"Alt-D",mac:"Alt-D"},exec:e=>e.execCommand("selectMoreAfter")},{name:"pycharm-reformat-code",bindKey:{win:"Ctrl-Alt-L",mac:"Command-Alt-L"},exec:e=>{if("function"==typeof n){const o=e.getValue(),t=e.getCursorPosition(),a=e.session.getScrollTop();Promise.resolve(n(o)).then(n=>{"string"==typeof n&&n!==o&&(e.setValue(n,-1),e.moveCursorToPosition(t),e.session.setScrollTop(a))}).catch(e=>{console.warn("Format failed:",e)})}}},{name:"pycharm-join-lines",bindKey:{win:"Ctrl-Shift-J",mac:"Ctrl-Shift-J"},exec:e=>{const n=ace.require("ace/range").Range,o=e.getSelectionRange();if(o.isEmpty()){const o=e.getCursorPosition().row,t=e.session.getLine(o);if("string"==typeof e.session.getLine(o+1)){const a=t.length;e.session.replace(new n(o,a,o+1,0)," ")}}else{const n=e.session.getTextRange(o).replace(/\n\s*/g," ");e.session.replace(o,n)}}}];for(const n of o)e.commands.addCommand(n)}const editorDefaultOptions={maxLines:1e3,selectionStyle:"text",highlightActiveLine:!0,highlightSelectedWord:!0,cursorStyle:"wide",mergeUndoDeltas:"always",copyWithEmptySelection:!1,useSoftTabs:!0,navigateWithinSoftTabs:!0,enableMultiselect:!0,hScrollBarAlwaysVisible:!1,vScrollBarAlwaysVisible:!1,highlightGutterLine:!0,animatedScroll:!1,showPrintMargin:!0,printMarginColumn:120,fadeFoldWidgets:!1,showFoldWidgets:!0,showLineNumbers:!0,showInvisibles:!0,showGutter:!0,displayIndentGuides:!0,fontSize:14,scrollPastEnd:.5,fixedWidthGutter:!0,firstLineNumber:1,overwrite:!1,newLineMode:"auto",useWorker:!0,tabSize:4,wrap:!1,mode:"ace/mode/python",theme:"ace/theme/dracula",enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1};export const initAceEditors=(e,n,o={})=>{const t=ace.edit(e);t.setOptions({...editorDefaultOptions,theme:"ace/theme/dracula"});const a={getCompletions:Completions(n),getDocTooltip:DocTooltip};return langTools.setCompleters([a,langTools.textCompleter]),bindPyCharmKeymap(t,{onFormat:o.onFormat}),t.markerLines=[],t.addMarkerLine=e=>{t.gotoLine(e,0);const n=new(0,ace.require("ace/range").Range)(e-1,0,e,0);return t.marker=t.session.addMarker(n,"err-line","line",!0),t.markerLines.push(t.marker),t.marker},t.removeAllMarkerLines=()=>{for(let e of t.markerLines)t.session.removeMarker(e);t.markerLines.length=0},t};