const firstWordReg=/^\s*!/,firstIndentedWord=/^\s{2,}!/,inAssignOrCall=/(?:[:=(]|if ).*!/,ifWhileReturn=/^\s*(?:if|while|return)/,colorReg=/^\s*(?:line|circle|rect|polygon|text|fill)\w*\s*\(\s*['"]!/,inString=/['"][^'"\n]*!/,isMethod=/\.\s*!/,defaultCompletions={abs:{meta:"absolute value",reg:inAssignOrCall},all:{meta:"all are True",reg:inAssignOrCall},and:{meta:"AND",reg:ifWhileReturn},any:{meta:"any is True",reg:inAssignOrCall},bin:{meta:"to binary",reg:inAssignOrCall},bool:{meta:"to boolean",reg:inAssignOrCall},break:{meta:"break loop",reg:firstIndentedWord},chr:{meta:"char by code",reg:inAssignOrCall},continue:{meta:"continue loop",reg:firstIndentedWord},def:{meta:"define function",reg:firstWordReg},del:{meta:"delete",reg:firstWordReg},dict:{meta:"dictionary",reg:inAssignOrCall},divmod:{meta:"quotient and remainder",reg:inAssignOrCall},drawzero:{meta:"drawing",reg:/import|from/},elif:{meta:"else if",score:70,reg:firstWordReg},else:{meta:"else",score:70,reg:firstWordReg},enumerate:{meta:"enumerate",reg:/^\s*for.*in.*!/},False:{meta:"false",reg:ifWhileReturn},float:{meta:"to float",reg:inAssignOrCall},"float(input())":{meta:"read float",score:140,reg:inAssignOrCall},for:{meta:"FOR loop",reg:firstWordReg},format:{meta:"formatting",reg:inAssignOrCall},from:{meta:"from",reg:/^(?:!|import)/},hex:{meta:"to hexadecimal",reg:inAssignOrCall},id:{meta:"object id",reg:inAssignOrCall},if:{meta:"if",score:80,reg:firstWordReg},import:{meta:"import",reg:/^(?:!|from)/},in:{meta:"in/among",reg:/(?:for|while|:|=|\().*!/},input:{meta:"input",score:100,reg:inAssignOrCall},int:{meta:"to integer",score:95,reg:inAssignOrCall},"int(input())":{meta:"read integer",score:150,reg:inAssignOrCall},is:{meta:"is identical to",reg:inAssignOrCall},len:{meta:"length",reg:inAssignOrCall},list:{meta:"list",reg:inAssignOrCall},map:{meta:"apply function to",reg:inAssignOrCall},max:{meta:"maximum",reg:inAssignOrCall},min:{meta:"minimum",reg:inAssignOrCall},None:{meta:"None, null value",reg:inAssignOrCall},not:{meta:"negation (NOT)",reg:ifWhileReturn},open:{meta:"open file",reg:inAssignOrCall},or:{meta:"OR",reg:ifWhileReturn},ord:{meta:"char code",reg:inAssignOrCall},pow:{meta:"to the power of",reg:inAssignOrCall},pass:{meta:"do nothing",reg:firstIndentedWord},print:{meta:"print",score:100,reg:firstWordReg},range:{meta:"number sequence",score:70,reg:/^\s*for.*in.*!/},repr:{meta:"representation",reg:inAssignOrCall},return:{meta:"return value",score:60,reg:firstIndentedWord},reversed:{meta:"reverse",reg:inAssignOrCall},round:{meta:"round number",reg:inAssignOrCall},set:{meta:"set",reg:inAssignOrCall},sorted:{meta:"sort",reg:inAssignOrCall},str:{meta:"to string",score:70,reg:inAssignOrCall},sum:{meta:"sum",reg:inAssignOrCall},True:{meta:"true",reg:ifWhileReturn},tuple:{meta:"tuple",reg:inAssignOrCall},type:{meta:"object type",reg:inAssignOrCall},while:{meta:"WHILE loop",score:70,reg:firstWordReg},zip:{meta:"combine iterables",reg:inAssignOrCall},add:{meta:"add to set",reg:isMethod},append:{meta:"append to list",reg:isMethod},bit_length:{meta:"bit length",reg:isMethod},copy:{meta:"copy",reg:isMethod},count:{meta:"count occurrences",reg:isMethod},discard:{meta:"discard from set",reg:isMethod},extend:{meta:"extend list",reg:isMethod},find:{meta:"find substring",reg:isMethod},get:{meta:"get by key",reg:isMethod},index:{meta:"element index",reg:isMethod},insert:{meta:"insert into list",reg:isMethod},isalpha:{meta:"is alphabetic",reg:isMethod},isdigit:{meta:"is digits",reg:isMethod},items:{meta:"(key,value) pairs",reg:isMethod},join:{meta:"join strings",reg:isMethod},keys:{meta:"dictionary keys",reg:isMethod},lower:{meta:"to lowercase",reg:isMethod},partition:{meta:"partition string",reg:isMethod},pop:{meta:"pop from list",reg:isMethod},popitem:{meta:"pop from dict",reg:isMethod},remove:{meta:"remove value",reg:isMethod},replace:{meta:"replace",reg:isMethod},reverse:{meta:"reverse list",reg:isMethod},rfind:{meta:"find from right",reg:isMethod},rindex:{meta:"index from right",reg:isMethod},rjust:{meta:"align right",reg:isMethod},rpartition:{meta:"partition from right",reg:isMethod},rstrip:{meta:"strip spaces right",reg:isMethod},sort:{meta:"sort list",reg:isMethod},split:{meta:"split string",reg:isMethod},splitlines:{meta:"split into lines",reg:isMethod},startswith:{meta:"starts with",reg:isMethod},strip:{meta:"strip spaces",reg:isMethod},update:{meta:"update dict",reg:isMethod},upper:{meta:"to uppercase",reg:isMethod},values:{meta:"dictionary values",reg:isMethod},zfill:{meta:"fill with zeros",reg:isMethod},as:{meta:"alias as",reg:/^\s*(?:import.*|with.*)!/},assert:{meta:"assert condition",reg:firstWordReg},except:{meta:"catch exception",reg:firstWordReg},filter:{meta:"filter sequence",reg:inAssignOrCall},finally:{meta:"cleanup block",reg:firstWordReg},isinstance:{meta:"check object type",reg:inAssignOrCall},lambda:{meta:"anonymous function",reg:inAssignOrCall},try:{meta:"exception handling",reg:firstWordReg},with:{meta:"context manager",reg:firstWordReg},yield:{meta:"return from generator",reg:firstIndentedWord},capitalize:{meta:"capitalize string",reg:isMethod},center:{meta:"center string",reg:isMethod},clear:{meta:"clear all items",reg:isMethod},endswith:{meta:"ends with",reg:isMethod},intersection:{meta:"intersection of sets",reg:isMethod},isspace:{meta:"is whitespace",reg:isMethod},ljust:{meta:"align left",reg:isMethod},lstrip:{meta:"strip spaces left",reg:isMethod},setdefault:{meta:"get, or set default",reg:isMethod},title:{meta:"to title case",reg:isMethod},union:{meta:"union of sets",reg:isMethod}};for(const key in defaultCompletions){const compl=defaultCompletions[key];compl.caption=key,compl.value=compl.value||key,compl.score=compl.score||50}const RU1=new Map([["а","a"],["б","b"],["в","v"],["г","g"],["д","d"],["е","e"],["є","e"],["ё","e"],["ж","j"],["з","z"],["и","i"],["ї","yi"],["й","i"],["к","k"],["л","l"],["м","m"],["н","n"],["о","o"],["п","p"],["р","r"],["с","s"],["т","t"],["у","u"],["ф","f"],["х","h"],["ц","c"],["ч","ch"],["ш","sh"],["щ","shch"],["ы","y"],["э","e"],["ю","u"],["я","ya"],["ъ",""],["ь",""]]),RU2=new Map([["й","q"],["ц","w"],["у","e"],["к","r"],["е","t"],["н","y"],["г","u"],["ш","i"],["щ","o"],["з","p"],["х","["],["ъ","]"],["ф","a"],["ы","s"],["в","d"],["а","f"],["п","g"],["р","h"],["о","j"],["л","k"],["д","l"],["ж",";"],["э","'"],["я","z"],["ч","x"],["с","c"],["м","v"],["и","b"],["т","n"],["ь","m"],["б",","],["ю","."],["ё","`"]]);function rusToLatin(str,ru){return Array.from(str).map((letter=>ru.get(letter)||letter)).join("")}export default completions=>{let curCompletions;if(completions&&completions.length>0){curCompletions=completions.map((capt=>"string"==typeof capt?defaultCompletions[capt]:capt)).filter((obj=>obj&&obj.caption));for(const compl of curCompletions)compl.value=compl.value||compl.caption,compl.score=compl.score||50;for(let i=curCompletions.length-1;i>=0;i-=1){const compl=curCompletions[i];let firstWord=compl.caption.split(" ")[0];if(compl.value===compl.caption&&/[а-яА-ЯёЁ]{2}/.test(firstWord)){const compl1=Object.assign({},compl),compl2=Object.assign({},compl);firstWord=firstWord.toLowerCase(),compl1.caption=rusToLatin(firstWord,RU1),compl2.caption=rusToLatin(firstWord,RU2),compl1.score-=10,compl2.score-=10,compl1.meta=compl.caption,compl2.meta=compl.caption,compl1.reg=inString,compl2.reg=inString,curCompletions.push(compl1,compl2)}}}else curCompletions=Object.values(defaultCompletions);return(editor,session,pos,prefix,callback)=>{let line=session.getLine(pos.row);line=`${line.slice(0,pos.column-prefix.length)}!${line.slice(pos.column)}`,callback(null,curCompletions.filter((compl=>(void 0===compl.reg||compl.reg.test(line))&&(void 0===compl.minPref||prefix.length>=compl.minPref))))}};