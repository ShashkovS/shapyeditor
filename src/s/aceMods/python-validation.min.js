"use strict";const skulptUrl=location.origin+"/s/skulpt/skulpt.min.js";importScripts(skulptUrl),Sk.configure({__future__:Sk.python3});const keywordNotInBrackets=/^.\b(as|assert|async|break|class|continue|def|del|except|finally|from|global|nonlocal|pass|raise|return|try|while|with|yield)\b/s,checkPairs=e=>{let t=e.replace(/\\\\|\\['"]/g,"--");const r=[];let n,l=null,s=null,o=1,i=!1;for(let e=0;e<t.length;e+=1){if(n=t[e],i)i="\n"!==n;else if("'"===l||'"'===l){if(n===l)l=null,r.pop();else if("\n"===n)return{row:o,text:`Строчка ${o} закончилась, а кавычки «${l}» всё нет`}}else if("'''"===l||'"""'===l)t.slice(e,e+3)===l&&(l=null,r.pop(),e+=2);else if('"'===n)l='"""'===t.slice(e,e+3)?'"""':'"',r.push([l,o]),e+=l.length-1;else if("'"===n)l="'''"===t.slice(e,e+3)?"'''":"'",r.push([l,o]),e+=l.length-1;else if(n===s){r.pop();let e=r[r.length-1];s=e?"["===e[0]?"]":"{"===e[0]?"}":")":null}else if("["===n)r.push([n,o]),s="]";else if("{"===n)r.push([n,o]),s="}";else if("("===n)r.push([n,o]),s=")";else{if("]"===n||"}"===n||")"===n)return 0===r.length?{row:o,text:`Непарные скобки! Все необходимые скобки уже закрыты, но в строке ${o} появилась лишняя закрывающая «${n}»`}:{row:o,text:`Непарные скобки! Ожидалось «${s}» (открыта в строке ${r[r.length-1][1]}), а пришло «${n}» в строке ${o}`};if("#"===n)i=!0;else if(r.length>0&&n>="a"&&n<="z"&&!(t[e-1].toLowerCase()>="a"&&t[e].toLowerCase()<="z")){const n=keywordNotInBrackets.exec(t.slice(e-1,e+11));if(n)return{row:o,text:`Непарные скобки! Не хватает «${r.reverse().map(e=>"["===e[0]?"]":"{"===e[0]?"}":")").join("")}» перед «${n[1]}»`}}}o+=+("\n"===n)}return l?{row:o,text:`В строке ${r[r.length-1][1]} с «${l}» началась строка и так и не закончилась.`}:1===r.length?{row:o,text:`Непарные скобки! Не хватает «${s}» (скобка открыта в строке ${r[0][1]})`}:r.length>0?{row:o,text:`Непарные скобки! Не хватает «${r.reverse().map(e=>"["===e[0]?"]":"{"===e[0]?"}":")").join("")}»`}:void 0},pythonValidation=(e,t)=>{new Date;const r=[],n=checkPairs(e);if(n)r.push({row:n.row-1,column:null,text:n.text,type:"error"});else try{Sk.parse("",e)}catch(e){let n;if(e instanceof Sk.builtin.IndentationError)n="IndentationError: "+e.args.v[0].v;else{if(!(e instanceof Sk.builtin.SyntaxError))throw console.error(JSON.stringify(e.args)),console.error(e),e;{const t=e.args.v[0].v;if("bad input"===t||"bad token T_OP"===t)try{n=`Вот этот код какой-то неправильный: «${e.args.v[3][2].trim()}»`}catch(e){n="В этой строчке что-то невалидное"}else"unindent does not match any outer indentation level"===t&&(n="Отступ некорректный, не соответсвует коду выше.")}}const l=e.traceback[0].lineno-1;l!==t&&r.push({row:l,text:n,type:"error"})}return r};