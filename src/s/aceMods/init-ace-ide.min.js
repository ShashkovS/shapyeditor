import"../ace/ace.min.js";import"../ace/ext-language_tools.js";import"../ace/ext-searchbox.js";import DocTooltip from"./doc-tooltip.js";import Completions from"./completions.js";import"./mode-python-with-worker.js";import{getAssetsBaseUrl,normalizeAssetsBaseUrl,resolveAssetUrlFrom}from"../cssNjs/asset-path.js";const ace=window.ace;let cachedAceBasePath=null;function stripTrailingSlash(e){return e?e.replace(/\/+$/,""):e}function resolveAceBasePath(e){const n=normalizeAssetsBaseUrl(null!=e?e:getAssetsBaseUrl());return stripTrailingSlash(resolveAssetUrlFrom(n,"../ace/"))}function ensureAceBasePath(e){const n=resolveAceBasePath(e);return cachedAceBasePath&&cachedAceBasePath===n||(ace.config.set("basePath",n),cachedAceBasePath=n),cachedAceBasePath}const langTools=ace.require("ace/ext/language_tools"),useragent=ace.require("ace/lib/useragent");function duplicateSmart(e){e.getSelectionRange().isEmpty()?e.execCommand("copylinesdown"):e.execCommand("duplicateSelection")}function bindPyCharmKeymap(e,{onFormat:n}={}){useragent.isMac;const t=[{name:"pycharm-duplicate",bindKey:{win:"Ctrl-D",mac:"Command-D"},exec:duplicateSmart},{name:"pycharm-delete-line",bindKey:{win:"Ctrl-Y",mac:"Command-Backspace"},exec:e=>e.execCommand("removeline")},{name:"pycharm-move-line-up",bindKey:{win:"Alt-Shift-Up",mac:"Alt-Shift-Up"},exec:e=>e.execCommand("movelinesup")},{name:"pycharm-move-line-down",bindKey:{win:"Alt-Shift-Down",mac:"Alt-Shift-Down"},exec:e=>e.execCommand("movelinesdown")},{name:"pycharm-toggle-line-comment",bindKey:{win:"Ctrl-/",mac:"Command-/"},exec:e=>e.execCommand("togglecomment")},{name:"pycharm-toggle-block-comment",bindKey:{win:"Ctrl-Shift-/",mac:"Command-Alt-/"},exec:e=>e.execCommand("toggleBlockComment")},{name:"pycharm-find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:e=>e.execCommand("find")},{name:"pycharm-replace",bindKey:{win:"Ctrl-R",mac:"Command-R"},exec:e=>e.execCommand("replace")},{name:"pycharm-find-next",bindKey:{win:"F3",mac:"F3"},exec:e=>e.execCommand("findnext")},{name:"pycharm-find-prev",bindKey:{win:"Shift-F3",mac:"Shift-F3"},exec:e=>e.execCommand("findprevious")},{name:"pycharm-add-caret-above",bindKey:{win:"Ctrl-Alt-Up",mac:"Option-Command-Up"},exec:e=>e.execCommand("addCursorAbove")},{name:"pycharm-add-caret-below",bindKey:{win:"Ctrl-Alt-Down",mac:"Option-Command-Down"},exec:e=>e.execCommand("addCursorBelow")},{name:"pycharm-select-next-occurrence",bindKey:{win:"Ctrl-G",mac:"Command-G"},exec:e=>e.execCommand("selectMoreAfter")},{name:"pycharm-reformat-code",bindKey:{win:"Ctrl-Alt-L",mac:"Command-Alt-L"},exec:e=>{if("function"==typeof n){const t=e.getValue(),o=e.getCursorPosition(),a=e.session.getScrollTop();Promise.resolve(n(t)).then(n=>{"string"==typeof n&&n!==t&&(e.setValue(n,-1),e.moveCursorToPosition(o),e.session.setScrollTop(a))}).catch(e=>{console.warn("Format failed:",e)})}}},{name:"pycharm-join-lines",bindKey:{win:"Ctrl-Shift-J",mac:"Ctrl-Shift-J"},exec:e=>{const n=ace.require("ace/range").Range,t=e.getSelectionRange();if(t.isEmpty()){const t=e.getCursorPosition().row,o=e.session.getLine(t);if("string"==typeof e.session.getLine(t+1)){const a=o.length;e.session.replace(new n(t,a,t+1,0)," ")}}else{const n=e.session.getTextRange(t).replace(/\n\s*/g," ");e.session.replace(t,n)}}}];for(const n of t)e.commands.addCommand(n)}const editorDefaultOptions={maxLines:1e3,selectionStyle:"text",highlightActiveLine:!0,highlightSelectedWord:!0,cursorStyle:"wide",mergeUndoDeltas:"always",copyWithEmptySelection:!1,useSoftTabs:!0,navigateWithinSoftTabs:!0,enableMultiselect:!0,hScrollBarAlwaysVisible:!1,vScrollBarAlwaysVisible:!1,highlightGutterLine:!0,animatedScroll:!1,showPrintMargin:!0,printMarginColumn:120,fadeFoldWidgets:!1,showFoldWidgets:!0,showLineNumbers:!0,showInvisibles:!0,showGutter:!0,displayIndentGuides:!0,fontSize:14,scrollPastEnd:.5,fixedWidthGutter:!0,firstLineNumber:1,overwrite:!1,newLineMode:"auto",useWorker:!0,tabSize:4,wrap:!1,mode:"ace/mode/python",theme:"ace/theme/dracula",enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1};export const initAceEditors=(e,n,t={})=>{ensureAceBasePath(t.assetsBaseUrl);const o=ace.edit(e);o.setOptions({...editorDefaultOptions,theme:"ace/theme/dracula"});const a={getCompletions:Completions(n),getDocTooltip:DocTooltip};return langTools.setCompleters([a,langTools.textCompleter]),bindPyCharmKeymap(o,{onFormat:t.onFormat}),o.markerLines=[],o.addMarkerLine=e=>{o.gotoLine(e,0);const n=new(0,ace.require("ace/range").Range)(e-1,0,e,0);return o.marker=o.session.addMarker(n,"err-line","line",!0),o.markerLines.push(o.marker),o.marker},o.removeAllMarkerLines=()=>{for(let e of o.markerLines)o.session.removeMarker(e);o.markerLines.length=0},o};